{% extends "layout.html" %} {% block content %}
<div class="www-doku">
  <section>
    <h1>Projektdokumentation - Metropol Theater Brunsbüttel</h1>
    <p><strong>Entwickelt von:</strong></p>
    <p>Christopher Friedrichs, Matrikelnummer: 730426</p>
    <p>Jana Golditz, Matrikelnummer: 730545</p>
    <br />
  </section>

  <section>
    <h1>Das Metropol Theater</h1>
    <p>
      Das Metropol Theater Brunsbüttel ist ein lokales Kino, das seinen Gästen
      aktuelle Filme und ein angenehmes Kinoerlebnis bietet. Unser Theater ist
      ein wichtiger kultureller Treffpunkt in der Gemeinde und zeigt sowohl
      Blockbuster als auch kleinere, anspruchsvolle Filme.
    </p>
    <p>
      Die Zielgruppe unserer Website sind Kinobesucher jeden Alters, die sich
      über das aktuelle Filmprogramm informieren möchten. Dazu gehören Familien,
      Filmliebhaber und alle, die einen schönen Abend im Kino verbringen möchten.
    </p>
  </section>

  <section>
    <h1>Ziel und Funktionsumfang der Anwendung</h1>
    <h2>Hauptziele</h2>
    <ul>
      <li>Übersichtliche Darstellung des aktuellen Filmprogramms</li>
      <li>Einfache Navigation zwischen verschiedenen Filmen und Terminen</li>
      <li>Detaillierte Informationen zu jedem Film</li>
      <li>Aktuelle Preisinformationen für Besucher</li>
      <li>Admin-Bereich für die Verwaltung von Filmen und Vorstellungen</li>
    </ul>

    <h2>Funktionsumfang</h2>
    <p><strong>Für Besucher:</strong></p>
    <ul>
      <li>Startseite mit Programm für heute, morgen und übermorgen</li>
      <li>Vollständige Programmübersicht für die nächsten 7 Tage</li>
      <li>Detailseiten für jeden Film mit Poster, Beschreibung und Terminen</li>
      <li>Preisübersicht für verschiedene Ticketarten</li>
      <li>Informationen über das Theater</li>
    </ul>

    <p><strong>Für Administratoren:</strong></p>
    <ul>
      <li>Sichere Anmeldung mit Passwort-Hash</li>
      <li>Filme erstellen, bearbeiten und löschen</li>
      <li>Poster-Upload für Filme</li>
      <li>Vorstellungen zu Filmen hinzufügen und verwalten</li>
      <li>Übersichtliches Dashboard mit Statistiken</li>
    </ul>
  </section>

  <section>
    <h1>Sicherheit und Bedrohungsmodell</h1>
    <h2>Mögliche Gefahren</h2>
    <p><strong>Was könnte passieren, wenn unsere Daten veröffentlicht werden?</strong></p>
    <ul>
      <li>Admin-Passwörter könnten missbraucht werden</li>
      <li>Filmdaten könnten manipuliert werden</li>
      <li>Falsche Vorstellungszeiten könnten Besucher verwirren</li>
      <li>Unbefugte könnten das System lahmlegen</li>
    </ul>

    <h2>Wie könnte das passieren?</h2>
    <ul>
      <li><strong>SQL-Injection:</strong> Angreifer versuchen, schädlichen Code über Formulare einzuschleusen</li>
      <li><strong>XSS-Angriffe:</strong> Gefährlicher JavaScript-Code könnte in die Website eingebaut werden</li>
      <li><strong>Unsichere Passwörter:</strong> Schwache Passwörter könnten erraten werden</li>
      <li><strong>Direkter Zugriff:</strong> Jemand könnte versuchen, direkt auf Admin-Bereiche zuzugreifen</li>
    </ul>

    <h2>Unsere Schutzmaßnahmen</h2>
    <ul>
      <li><strong>Passwort-Hashing:</strong> Alle Passwörter werden mit bcrypt gehashed gespeichert</li>
      <li><strong>SQL-Injection-Schutz:</strong> Wir verwenden prepared statements mit Platzhaltern und Pattern-basierte Erkennung</li>
      <li><strong>XSS-Schutz:</strong> Multi-Pattern XSS-Erkennung mit HTML-Entity-Encoding, Script-Tag-Filterung und Event-Handler-Blockierung</li>
      <li><strong>CSRF-Protection:</strong> Token-basierte Sicherheit für alle Formulare</li>
      <li><strong>Input-Sanitization:</strong> Umfassende Validierung und Bereinigung aller Eingaben</li>
      <li><strong>Zugriffskontrolle:</strong> Admin-Bereiche sind durch Middleware geschützt</li>
      <li><strong>Rate Limiting:</strong> Schutz vor automatisierten Angriffen</li>
      <li><strong>Security Headers:</strong> Content Security Policy, X-Frame-Options, HSTS</li>
      <li><strong>Session-Sicherheit:</strong> Sichere Session-Verwaltung mit automatischem Timeout</li>
    </ul>
  </section>

  <section>
    <h1>Qualitätssicherung durch Tests</h1>
    <h2>Umfassende Test-Suite</h2>
    <p>
      Unser Projekt verfügt über eine ausführliche Test-Suite mit fast 100 automatisierten Tests,
      die verschiedene Aspekte der Anwendung abdecken und in dem <code>tests/</code> Verzeichnis
      organisiert sind:
    </p>

    <h3>Unit-Tests</h3>
    <ul>
      <li><strong>Sanitizer-Tests:</strong> Validierung aller Input-Sanitization-Funktionen</li>
      <li><strong>Database-Tests:</strong> Sichere SQL-Query-Ausführung und Injection-Schutz</li>
      <li><strong>Model-Tests:</strong> CRUD-Operationen für Filme, Shows und User</li>
      <li><strong>Validation-Tests:</strong> XSS-Pattern-Erkennung und HTML-Entity-Encoding</li>
      <li><strong>CSRF-Tests:</strong> Token-Generierung und -Validierung</li>
    </ul>

    <h3>Integration-Tests</h3>
    <ul>
      <li><strong>Controller-Tests:</strong> End-to-End-Tests aller HTTP-Endpoints</li>
      <li><strong>Security-Tests:</strong> Rate-Limiting und Security-Header-Validation</li>
      <li><strong>Session-Tests:</strong> Login/Logout-Funktionalität und Session-Sicherheit</li>
      <li><strong>File-Upload-Tests:</strong> Sichere Poster-Upload-Funktionalität</li>
      <li><strong>Error-Handling-Tests:</strong> Proper Fehlerbehandlung und Logging</li>
    </ul>

    <h3>Test-Coverage</h3>
    <p>
      Die Test-Suite erreicht eine Code-Coverage von über 63% und stellt sicher,
      dass alle kritischen Sicherheitsfeatures und Geschäftslogik korrekt funktionieren.
      Tests werden automatisch bei jeder Code-Änderung ausgeführt und die Ergebnisse
      werden im <code>coverage/</code> Verzeichnis gespeichert.
    </p>

    <h3>Sicherheitstests</h3>
    <ul>
      <li><strong>SQL-Injection-Tests:</strong> Verschiedene Injection-Patterns werden getestet</li>
      <li><strong>XSS-Prevention-Tests:</strong> Script-Tag-Filterung und Event-Handler-Blockierung</li>
      <li><strong>Input-Validation-Tests:</strong> Grenzwerte und ungültige Eingaben</li>
      <li><strong>Authentication-Tests:</strong> Password-Hashing und Session-Sicherheit</li>
    </ul>

    <h3>Test-Ausführung</h3>
    <p>
      Tests können mit <code>deno test</code> ausgeführt werden. Das Projekt nutzt
      Denos eingebaute Test-Runner und Assertion-Bibliothek für maximale Kompatibilität
      und Performance.
    </p>
  </section>

  <section>
    <h1>Inhaltstypen und Funktionen</h1>
    <h2>Hauptinhaltstypen</h2>

    <h3>1. Filme</h3>
    <ul>
      <li><strong>Felder:</strong> Titel, Regisseur, Dauer, Beschreibung, Besetzung, Poster, Erscheinungsjahr</li>
      <li><strong>Funktionen:</strong> Erstellen, Anzeigen, Bearbeiten, Löschen</li>
      <li><strong>Besonderheiten:</strong> Poster-Upload mit Validierung</li>
    </ul>

    <h3>2. Vorstellungen (Shows)</h3>
    <ul>
      <li><strong>Felder:</strong> Film-Zuordnung, Datum, Uhrzeit</li>
      <li><strong>Funktionen:</strong> Zu Filmen hinzufügen, Bearbeiten, Löschen</li>
      <li><strong>Besonderheiten:</strong> Automatische Verknüpfung mit Filmen</li>
    </ul>

    <h3>3. Benutzer (Admins)</h3>
    <ul>
      <li><strong>Felder:</strong> Benutzername, gehashtes Passwort</li>
      <li><strong>Funktionen:</strong> Anmelden, Abmelden, Session-Verwaltung</li>
    </ul>
  </section>

  <section>
    <h1>Aufbau der Datenbank</h1>
    <h2>Datenbankstruktur</h2>
    <p>Wir verwenden SQLite als Datenbank. Die Struktur ist einfach aber effektiv:</p>

    <h3>Tabelle: films</h3>
    <ul>
      <li><strong>id:</strong> Eindeutige Film-ID (Primärschlüssel)</li>
      <li><strong>title:</strong> Filmtitel</li>
      <li><strong>director:</strong> Regisseur</li>
      <li><strong>duration:</strong> Filmdauer in Minuten</li>
      <li><strong>description:</strong> Filmbeschreibung</li>
      <li><strong>cast:</strong> Schauspieler</li>
      <li><strong>poster_url:</strong> Pfad zum Poster-Bild</li>
      <li><strong>release_date:</strong> Erscheinungsjahr</li>
      <li><strong>created_at:</strong> Erstellungsdatum</li>
    </ul>

    <h3>Tabelle: shows</h3>
    <ul>
      <li><strong>id:</strong> Eindeutige Vorstellungs-ID</li>
      <li><strong>film_id:</strong> Verknüpfung zum Film (Fremdschlüssel)</li>
      <li><strong>date:</strong> Vorstellungsdatum</li>
      <li><strong>time:</strong> Vorstellungszeit</li>
      <li><strong>created_at:</strong> Erstellungsdatum</li>
    </ul>

    <h3>Tabelle: users</h3>
    <ul>
      <li><strong>id:</strong> Eindeutige Benutzer-ID</li>
      <li><strong>username:</strong> Benutzername</li>
      <li><strong>password:</strong> Gehashtes Passwort</li>
      <li><strong>created_at:</strong> Erstellungsdatum</li>
    </ul>

    <h2>Datenbankverbindungen</h2>
    <p>
      Die Shows-Tabelle ist über film_id mit der Films-Tabelle verknüpft.
      Wenn ein Film gelöscht wird, werden automatisch alle zugehörigen
      Vorstellungen mit gelöscht (CASCADE DELETE).
    </p>
  </section>

  <section>
    <h1>Aufbau der Anwendung (MVC-Architektur)</h1>
    <h2>Verzeichnisstruktur</h2>
    <pre>
src/
├── controllers/     # Controller für Geschäftslogik
├── models/         # Datenbank-Models
├── routes/         # URL-Routing
├── templates/      # HTML-Templates (Views)
├── middleware/     # Eigene Middleware
├── services/       # Hilfsdienste
└── utils/          # Utility-Funktionen
    </pre>

    <h2>Model-View-Controller Konzept</h2>
    <h3>Models (Datenbank)</h3>
    <ul>
      <li><strong>filmModel.js:</strong> Alle Datenbankoperationen für Filme</li>
      <li><strong>showModel.js:</strong> Operationen für Vorstellungen</li>
      <li><strong>userModel.js:</strong> Benutzer-Verwaltung</li>
    </ul>

    <h3>Views (Templates)</h3>
    <ul>
      <li><strong>layout.html:</strong> Grundlayout mit Navigation</li>
      <li><strong>index.html:</strong> Startseite</li>
      <li><strong>movieDetail.html:</strong> Film-Detailseite</li>
      <li><strong>dashboard.html:</strong> Admin-Dashboard</li>
      <li><strong>login.html:</strong> Login-Seite</li>
    </ul>

    <h3>Controllers (Geschäftslogik)</h3>
    <ul>
      <li><strong>siteController.js:</strong> Öffentliche Seiten</li>
      <li><strong>filmController.js:</strong> Film-Verwaltung</li>
      <li><strong>adminController.js:</strong> Admin-Funktionen</li>
    </ul>

    <h2>Warum diese Aufteilung?</h2>
    <p>
      Die MVC-Architektur trennt sauber zwischen Daten (Model), Darstellung (View)
      und Logik (Controller). Das macht den Code:
    </p>
    <ul>
      <li>Einfacher zu verstehen</li>
      <li>Leichter zu warten</li>
      <li>Besser zu testen</li>
      <li>Einfacher zu erweitern</li>
    </ul>
  </section>

  <section>
    <h1>URL-Pfade und Routing</h1>
    <h2>Öffentliche Bereiche</h2>
    <ul>
      <li><strong>/</strong> - Startseite mit heutigem Programm</li>
      <li><strong>/programm</strong> - Vollständige Programmübersicht</li>
      <li><strong>/film/:id</strong> - Film-Detailseite</li>
      <li><strong>/preise</strong> - Preisübersicht</li>
      <li><strong>/ueberuns</strong> - Über das Theater</li>
      <li><strong>/impressum</strong> - Impressum</li>
      <li><strong>/datenschutz</strong> - Datenschutzerklärung</li>
    </ul>

    <h2>Admin-Bereiche (geschützt)</h2>
    <ul>
      <li><strong>/admin/login</strong> - Admin-Anmeldung</li>
      <li><strong>/admin</strong> - Dashboard (nur nach Login)</li>
      <li><strong>/admin/films</strong> - Film-Verwaltung</li>
      <li><strong>/admin/films/update/:id</strong> - Film bearbeiten</li>
      <li><strong>/admin/films/delete/:id</strong> - Film löschen</li>
    </ul>

    <h2>Warum diese Struktur?</h2>
    <p>
      Die URLs sind logisch aufgebaut und selbsterklärend. Besucher finden
      sich schnell zurecht, und Suchmaschinen können die Seiten gut verstehen.
    </p>
  </section>

  <section>
    <h1>JavaScript im Frontend</h1>
    <h2>Grundprinzip: Progressive Enhancement</h2>
    <p>
      Unsere Website funktioniert komplett ohne JavaScript. Das ist wichtig,
      weil nicht alle Besucher JavaScript aktiviert haben oder moderne Browser
      verwenden.
    </p>

    <h2>JavaScript-Verbesserungen</h2>
    <p>Wo wir JavaScript einsetzen:</p>
    <ul>
      <li><strong>Datei-Upload-Vorschau:</strong> Zeigt Bilder vor dem Upload an</li>
      <li><strong>Dynamische Felder:</strong> Vorstellungen zu Filmen hinzufügen/entfernen</li>
    </ul>

    <h2>Warum Progressive Enhancement?</h2>
    <ul>
      <li>Funktioniert auch ohne JavaScript</li>
      <li>Besser für Barrierefreiheit</li>
      <li>Funktioniert auf allen Geräten</li>
      <li>Bessere Performance</li>
    </ul>
  </section>

  <section>
    <h1>Externe Komponenten und Abhängigkeiten</h1>
    <h2>Backend-Module (Deno)</h2>
    <ul>
      <li><strong>Oak:</strong> Web-Framework für Routing und Middleware</li>
      <li><strong>Oak Sessions:</strong> Session-Verwaltung für Login</li>
      <li><strong>SQLite:</strong> Datenbank-Engine</li>
      <li><strong>Nunjucks:</strong> Template-Engine für HTML-Rendering</li>
      <li><strong>bcrypt:</strong> Passwort-Hashing</li>
    </ul>

    <h2>Frontend-Ressourcen</h2>
    <ul>
      <li><strong>Google Fonts:</strong> Für schöne Schriftarten</li>
      <li><strong>Eigenes CSS:</strong> Komplettes Design selbst erstellt</li>
      <li><strong>Minimales JavaScript:</strong> Nur für Verbesserungen</li>
    </ul>

    <h2>Warum diese Auswahl?</h2>
    <ul></ul>
      <li><strong>Oak:</strong> Modernes, sicheres Framework für Deno</li>
      <li><strong>SQLite:</strong> Einfach, zuverlässig, keine separate Installation nötig</li>
      <li><strong>Nunjucks:</strong> Sicheres Template-System mit Auto-Escaping</li>
      <li><strong>Eigenes CSS:</strong> Vollständige Kontrolle über das Design</li>
    </ul>
  </section>

  <section>
    <h1>Vorlagen und Inspiration</h1>
    <h2>Lehrmaterialien</h2>
    <p>
      Die Grundstruktur basiert auf den Übungen aus dem WWW-Labor.
      Besonders die letzte Aufgabe war eine gute Vorlage für unser Projekt.
    </p>

    <h2>Design-Inspiration</h2>
    <ul>
      <li>Einfache, klare Layouts moderner Websites</li>
      <li>Fokus auf Lesbarkeit und einfache Navigation</li>
      <li>Responsive Design für verschiedene Geräte</li>
    </ul>

    <h2>Technische Vorbilder</h2>
    <ul></ul>
      <li>MVC-Pattern aus bewährten Web-Frameworks</li>
      <li>REST-API Design-Prinzipien</li>
      <li>Moderne Sicherheitspraktiken</li>
    </ul>
  </section>

  <section>
    <h1>Aufgetretene Probleme und Lösungen</h1>
    <h2>Oak FormData Problem</h2>
    <p><strong>Problem:</strong> Oak v12.6.1 hatte Probleme mit Multipart-FormData</p>
    <p><strong>Lösung:</strong> Eigene FormDataParser-Klasse entwickelt, die auf Byte-Ebene arbeitet</p>

    <h2>Poster-Upload verschwindet</h2>
    <p><strong>Problem:</strong> Poster waren nach dem Erstellen weg</p>
    <p><strong>Lösung:</strong> Binary-Data richtig behandeln, keine Text-Konvertierung</p>

    <h2>Falsche HTTP-Status-Codes</h2>
    <p><strong>Problem:</strong> API gab immer 302 Redirect zurück</p>
    <p><strong>Lösung:</strong> Unterscheidung zwischen Browser und API-Requests</p>

    <h2>Unit-Tests schlagen fehl</h2>
    <p><strong>Problem:</strong> Tests verwendeten alte FormData-API</p>
    <p><strong>Lösung:</strong> Test-Mocks für neue FormDataParser erstellt</p>
  </section>


</div>
{% endblock %}
